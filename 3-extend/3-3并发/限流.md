# 一、常见的限流算法
https://www.alibabacloud.com/blog/throttling-solutions-in-standalone-and-distributed-scenarios_
## 计数器（固定窗口）：
每个时间窗口会刷新计数器，会存在临界问题；比如每分钟限流100，但是再59秒和1分1秒时分别涌入
100的流量，那么实际上这两秒内的流量是200。
缺陷：临界问题
## 滑动窗口
滑动窗口将时间分割为不同的片段，每个片段去平均的分担流量；比如将1min分割为6个窗口，每个窗口10秒，
每个窗口流量为20个，当个头部时间窗口过期后，向后“滑动”添加20个流量。
缺陷：滑动窗口将时间窗口分割得更小，但是本质上并未解决窗口限流得临界问题。
## 漏桶算法； 
请求被集中在桶中，算法均匀的处理请求，比如每秒处理5个请求；当请求的流速大于算法处理的速度可能会导致桶
溢出，这部分请求将会被抛弃。
缺陷：因为限制了处理速度，单位时间内处理得请求数量是固定的，
## 令牌桶算法；
以均匀的速率生成令牌存入令牌桶，令牌桶满后，新创建的令牌丢弃；如果请求的时候桶中无令牌，请求被丢弃。
相对于漏桶算法，可以处理突发流量。


## **思考**
场景描述：设漏桶容量和令牌桶的容量都为100，一段时间内没有请求，漏桶为空、令牌桶已经满了；
此时突发流量150，无论是漏桶还是令牌桶都是能且只能接住100的流量，剩下的50被抛弃。
问题：只不过漏桶起到了缓冲作用，后面匀速处理这部分流量；而令牌桶是直接将100的流量打给了应用；
并没有漏桶处理不了突发流量的问题。**而且当应用的CPU使用率本身就比较高，预期分给当前限流接口的资源**
**本来就比较少，如果将100哥请求全部同时打给应用，那么对于应用来说会占用其它接口的CPU资源，并且产生**
**频繁的上下文切换。导致总体的性能下降**

结论：
漏桶算法适用场景：对于限流接口的处理速率有很强的限制需求，CPU资源紧张，保证当前限流接口不能“占用”其它接口资源。
可以实现一定程度上的资源隔离。
令牌桶适用场景：对各个接口的限流没有很强的诉求，整体的资源可能有富余，那么当出现突发流量时候，令牌桶可以更好得
应用空闲资源。






## 1.1 计数器实现原理

## 1.2 滑动窗口
（1）将1秒拆成n份，每份需要记录这段时间内请求的数量；
（2）使用节点数量为n的环链List（类似时间轮），每个节点保存在当前节点的时间范围内的请求数量；
（3）List的遍历，使用带有超时时间的等待，